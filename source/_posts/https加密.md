---
title: https
date: 2021-10-03 16:56:43
tags: https
index_img: /images/https加密/https流程图.png
---
### 对称加密

起初yxfan和cheney之间的通信都是明文的，这无疑是在网络上裸奔啊。任何一个人都能监听他们之间的通信，打开数据包，窥探隐私。

后来yxfan说，要不我们在发送消息之前，先把消息加密，到我们手里时再用密钥解密，这样就算被中间人劫持了他也看不懂。

接发双方用同一个密钥的加密方式就叫`对称加密`。如图所示：

<img style="display: block ;margin: 0 auto;height: 15rem" src="/images/https加密/对称加密.png"/>

这有点像谍战片里接发电报，双方事先约定好一套密码本，通信时都用的数字代码，这样一来就算被敌人拦截，他们也无从下手。

万一被叛徒出卖，密码本被敌人发现了，之前约定的方式肯定有暴露的风险，现在急需一套新的密码本，但是怎么传给远在潜伏区的同志们呢？只能派人携带密码本突破重重封锁，带到潜伏区。

当然了，现在传送密钥不用流血牺牲，但成本也是不小的，因为你不能直接将密钥通过网络传输，有暴露的风险，在传输过程中。一旦被中间人劫持到密钥，接发双方之间的通信内容，也会被中间人一收眼底。难道就没有更好更安全到方法了吗？

### 非对称加密（RSA）

和对称加密不同的是，RSA算法有一对密钥，分别为`公钥`和`私钥`，顾名思义公钥是大家都知道的，咱地球人都知道；私钥可得保存好了，只有咱自个儿知道。有趣的是，用公钥加密的数据，只有对应的私钥才能解；用私钥加密的数据，只有对应的公钥才能解。

<img style="display: block ;margin: 0 auto;height: 15rem" src="/images/https加密/公钥和私钥.png"/>

现在我们可以用这种方式安全的通信了。以yxfan给cheney发消息为例，
- 1、cheney先把自己的公钥发给yxfan，
- 2、yxfan拿到了cheney的公钥后，yxfan将消息用公钥加密，传输给cheney，传输过程中就算被中间人劫持了，也无法解密，因为他没有私钥啊，傻眼了吧
- 3、cheney收到消息后，用自个儿的私钥解密，成功读取到数据

<img style="display: block ;margin: 0 auto;height: 25rem" src="/images/https加密/非对称加密.png"/>

RSA算法也有弊端，加密和解密的速度有点慢，与对称加密算法相比要慢百倍有余

### 非对称加密+对称加密

回到最初的问题上，我们就是想要一个密钥来加密通信而已，对称加密的加解密比较快，但是对称密钥可能被截取，而非对称加解密较安全，但速度堪忧。那为啥不把两者相结合呢：

- 我生成一个密钥，通过RSA方式安全的传送给你
- 你收到密钥后，我们后续就用这个密钥来对称加密通信

如此，即解决了密钥的传输问题，有解决了RSA速度慢的问题

### 中间人劫持

如果cheney给yxfan发公钥的时候，被一个中间人截取了cheney的公钥，然后把自己的公钥发给了yxfan，冒充cheney。导致yxfan发的消息都用了中间人的公钥加密，中间人马上就能通过自己的私钥解密，这不就看到消息了吗？

这个中间人解密后，还可以用cheney的公钥加密，发给cheney，cheney和yxfan根本意识不到通信已被窥探，还以为在安全传输呢。

<img style="display: block ;margin: 0 auto;height: 25rem" src="/images/https加密/中间人劫持.png"/>

问题是出在公钥的分发上，虽然公钥是公开的，但是别有用心的人还是可以截取干坏事。

### 数字签名

回到最初的问题上：怎么安全保护密钥？这一次的公钥是公开的，必须保证这个公钥一定得是cheney的，而不是别人的。

我们现实生活中有公证中心，我们也可以模拟一个具有公信力的认证中心，给cheney颁发一个证书，里面就包括了公钥，如此一来我们直接获取证书就可以了。

有了以上的经验，万一在证书传输过程中，被中间人篡改了怎么办？（这些坏人总是无孔不入！）

数字签名闪亮✨登场

cheney把自己的公钥和个人信息，通过一种Hash算法生成一个消息摘要。这种Hash有种特性，只要输入数据有一点变化，生成的消息摘要就有巨变，这样可以防止别人篡改原有内容。

尽管不能篡改了，中间人索性把整个原始信息都给替换了，我们仍然分辨不出来啊。

可恶的中间人，真是坏透了。方法总比困难多，cheney让有公信力的认证中心（CA）把自己生成的消息摘要通过CA私钥加密生成数字签名。

除此之外，认证中心还能够把原始信息和数字签名合在一起形成数字证书。流程如下图：

<img style="display: block ;margin: 0 auto;height: 20rem" src="/images/https加密/数字证书.png"/>

当cheney把自己的证书发给yxfan时，yxfan用同样的Hash算法把证书中的原始信息生成一个消息摘要，紧接着用CA的公钥对证书中的签名进行解密，用新的消息摘要和解密后的消息摘要两者对比，如果一样，则没有被篡改，就可以顺利拿到cheney的公钥了，如此一来公钥的分发就解决啦！后续的加密工作就可以开始了。

<img style="display: block ;margin: 0 auto;height: 10rem" src="/images/https加密/验证数字证书.png"/>



### https流程图

一个简化版的HTTPS流程图如下图所示：

<img style="display: block ;margin: 0 auto;height: 30rem" src="/images/https加密/https流程图.png"/>

